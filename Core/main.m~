% 清除工作区
clear;
close all;
clc;

%% 读取数据
%设置压力传感器以及惯性传感器测试数据的路径 

% ImuFilePath = '../RawData/new1212/jixielou.csv';
% PlantarFilePath = '../RawData/new1212/Plantar_7ceng_yiquan.csv';
% ImuFilePath = '../RawData/new1212/Imu_wave.csv';
% ImuFilePath = '../RawData/new1212/Imu_wave1.csv';
% ImuFilePath = '../RawData/new1212/Imu_zwave.csv';

% ImuFilePath = '../RawData/new1212/Imu_xacjixielou7.csv';
% ImuFilePath = '../RawData/new1212/Imu_cppjixielou7.csv';
% ImuFilePath = '../RawData/new1212/Imu_chtjixielou7.csv';
% ImuFilePath = '../RawData/new1212/Imu_szpjixielour.csv';
% ImuFilePath = '../RawData/new1212/Imu_xiaoquan.csv';

% ImuFilePath = '../RawData/new1212/Imu_xacjixielou7r.csv';
% ImuFilePath = '../RawData/new1212/Imu_xacjixielou7l.csv';

% ImuFilePath = '../RawData/new0105/Imu_chl_7ceng_r.csv';
% ImuFilePath = '../RawData/new0105/Imu_szp_7ceng_r.csv';
% ImuFilePath = '../RawData/new0105/Imu_chl_7ceng_l.csv';
% ImuFilePath = '../RawData/new0105/Imu_szp_7ceng_l.csv';
% ImuFilePath = '../RawData/new0105/Imu_3_12_4quan.csv';
% ImuFilePath = '../RawData/new0105/Imu_jixiedayuan_L_2';
% ImuFilePath = '../RawData/new0105/Imu_jixiedayuan_R_2';

% ImuFilePath = '../RawData/new0105/Imu_zhuanquan120s.csv'; 
% ImuFilePath = '../RawData/new0105/Imu_4_7方形慢走.csv'; 

% ImuFilePath = '../RawData/new0105/Imu_操场逆时针1圈.csv'; 
% PlantarFilePath = '../RawData/new0105/Plantar_操场逆时针1圈.csv';

% ImuFilePath = '../RawData/new0105/Imu_机械楼2层3圈.csv'; 
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼2层3圈.csv';

ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈.csv';             %
PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈.csv';

% ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈_L.csv'; 
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈_L.csv';

% ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈_6.csv';
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈_6.csv';

% ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈_7.csv';     %imu有脏数据
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈_7.csv';

% ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈_8.csv';
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈_8.csv';

% ImuFilePath = '../RawData/new0105/Imu_chtjixielou7-9.csv'; 
% ImuFilePath = '../RawData/new0105/Imu_cht机械楼7.csv';      
% ImuFilePath = '../RawData/new0105/Imu_cht机械楼7_1.csv';     %好
% ImuFilePath = '../RawData/new0105/Imu_cht机械楼7_2.csv';     %好
% ImuFilePath = '../RawData/new0105/Imu_cht机械楼7_4.csv';     
% ImuFilePath = '../RawData/new0105/Imu_cht机械楼7_5.csv'; 
% ImuFilePath = '../RawData/new0105/Imu_cht小圈5圈.csv'; 
% ImuFilePath = '../RawData/new0105/Imu_cht教研室c字来回.csv'; 

% ImuFilePath = '../RawData/new0105/Imu_szp机械楼7.csv'; 

% ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈_9.csv';
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈_9.csv';

% ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈_10.csv';    %好
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈_10.csv';


% ImuFilePath = '../RawData/new0105/Imu_00000test.csv'; 
% ImuFilePath = '../RawData/new0105/Imu_test0011.csv'; 

% ImuFilePath = '../RawData/new0416/Imu_test_chl.csv';  
% ImuFilePath = '../RawData/new0416/Imu_chl5up7stair.csv';
% ImuFilePath = '../RawData/new0416/Imu_chl7down5stair.csv';
% ImuFilePath = '../RawData/new0416/Imu_test1.csv';
% ImuFilePath = '../RawData/new0416/Imu_test2.csv';
% ImuFilePath = '../RawData/new0416/Imu_test3.csv';
% ImuFilePath = '../RawData/new0416/Imu_test4.csv';
% ImuFilePath = '../RawData/new0416/Imu_downtest.csv';
% ImuFilePath = '../RawData/new0416/Imu_uptest.csv';


% ImuFilePath = '../RawData/new0529/Imu_chl_0529_七楼1圈.csv';

% ImuFilePath = '../RawData/new0529/Imu_chl_0530_7楼1圈第一次.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0530_7楼1圈第二次.csv';
% ImuFilePath = '../RawData/new0529/Imu_xac_0530_7楼一圈.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0531_七楼一圈第一次.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0531_七楼一圈第二次.csv';
% ImuFilePath = '../RawData/new0529/Imu_xac_0531_7楼一圈（1）.csv';
% ImuFilePath = '../RawData/new0529/Imu_xac_0531_7楼一圈（2）.csv';
% ImuFilePath = '../RawData/new0529/Imu_xac_0531_7楼一圈（3）.csv';
% ImuFilePath = '../RawData/new0529/Imu_usb供电_静止60s.csv';

% ImuFilePath = '../RawData/new0529/Imu_chl_0603_七楼一圈第一次.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0603_七楼一圈第二次.csv';

% ImuFilePath = '../RawData/new0529/Imu_chl_0604_七楼一圈第一次.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0604_七楼一圈第二次.csv';
% ImuFilePath = '../RawData/new0529/Imu_xac_七楼一圈_16mHz关掉_陀螺仪零偏校准.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0604_七楼一圈第一次去掉高通.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0604_七楼一圈第二次去掉高通.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0605_七楼一圈第一次.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0605_七楼一圈第二次.csv';
% ImuFilePath = '../RawData/new0529/Imu_chl_0613_七楼一圈测试.csv';


% ImuFilePath = '../RawData/new0616/Imu_chl_0615_充电宝七楼一圈(1).csv';
% ImuFilePath = '../RawData/new0616/Imu_chl_0615_充电宝七楼一圈加楼梯787.csv';
% ImuFilePath = '../RawData/new0616/Imu_chl_0616_七楼一圈.csv';


% ImuFilePath = '../RawData/new0105/Imu_机械楼7层1圈.csv';   %好
% PlantarFilePath = '../RawData/new0105/Plantar_机械楼7层1圈.csv';


% ImuFilePath = '../RawData/data1008/Imu_chl_0620_七楼一圈第一次.csv';
% ImuFilePath = '../RawData/data1008/Imu_chl_0620_七楼一圈第二次.csv';
% ImuFilePath = '../RawData/data1008/Imu_chl_0620_七楼一圈第三次.csv';
% ImuFilePath = '../RawData/data1008/Imu_chl_0620_七楼一圈第四次.csv';
ImuFilePath = '../RawData/data1008/Imu_chl_0621_七楼一圈第一次.csv';
% ImuFilePath = '../RawData/data1008/Imu_chl_0621_七楼一圈第二次.csv';
% ImuFilePath = '../RawData/data1008/Imu_七层一圈_1号板.csv';

ImuFilePath = '../RawData/1015操场测试/合并/Imu_方形a1.csv';
PlantarFilePath = '../RawData/1015操场测试/合并/Plantar_方形a1.csv';


%% 构建
%读取.csv格式的测试程序，将压力传感器数据和惯性传感器数据分别送入pHandler和iHandler
%构建状态迭代器（StateCalculator），同时可以构建多个StateCalculator，进行多种.算法和参数的同时计算和比较
%构建StateCalculator时除了默认的iHandler,pHandler两个参数，还可以以键值对的形式送入可变变量
%用于设置StateCalculator的算法和参数，为输入的变量将按默认值构建
%可以传入的可变参数如下：
%   'Attitude',     WHOLE_ATTITUDE      三轴姿态修正(默认)
%                   YAW_ATTITUDE        仅航向修正
%                   
%                   NONE_ATTITUDE       不启用姿态修正
%   'Position',     VERTICAL_POSITION   启用高度修正
%                   NONE_POSITION       不启用位移修正
%   'noiseW'        预测噪声（陀螺仪噪声）
%   'noiseF'        预测噪声（加速度计噪声）
%   'noiseG'        观测噪声噪声（互补滤波重力加速度噪声）
%   'noiseM'        系统噪声（磁力计噪声）
%   'noiseV'        系统噪声（速度噪声）
%   'noiseH'        系统噪声（高度计计噪声）

%构建pHandler和iHandler
iHandler = ImuHandler(ImuFilePath);
pHandler = PlantarHandler(PlantarFilePath,iHandler);


%%
%构建StateCalculator
% stateCal6 = StateCalculator(iHandler, pHandler, 'Attitude',Utils.NONE_ATTITUDE, 'Position', Utils.NONE_POSITION);
% stateCal2 = StateCalculator(iHandler, pHandler);
% stateCal2 = StateCalculator(iHandler, pHandler, 'AHRS', Utils.AHRS_MAHONY, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.02, 'Mahony_Ki', 0.001);
% stateCal3 = StateCalculator(iHandler, pHandler, 'AHRS', Utils.AHRS_MADGWICK, 'Aligner', Utils.AHRS_MADGWICK, 'Madgwick_Beta', 0.005);
% stateCal1 = StateCalculator(iHandler, pHandler, 'AHRS', Utils.AHRS_EKF, 'Aligner', Utils.AHRS_MADGWICK);

% stateCal1 = StateCalculator(iHandler, pHandler, 'Position', Utils.NONE_POSITION, 'ZUP_noiseW', 0.02, 'ZUP_noiseF', 600, 'ZUP_noiseG', 300, 'ZUP_noiseM', 600, 'ZUP_noiseV', 300, 'ZUP_noiseH', 40, 'ZUP_factorS', 1.000005);
         
% stateCal1 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.00000002, 'ZEKF_noiseF',0.0006, 'ZEKF_noiseG', 0.01, 'ZEKF_noiseV', 0.0012, 'ZEKF_noiseM', 0.016, 'ZEKF_noiseH', 0.0005, 'ZEKF_fadeQ', 1.0005, 'ZEKF_fadeWb', 1.000005, 'ZEKF_fadeV', 1.000005, 'ZEKF_fadeP', 1.00005);
% stateCal1 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.00000002, 'ZEKF_noiseF',0.0006, 'ZEKF_noiseG', 0.01, 'ZEKF_noiseV', 0.0012, 'ZEKF_noiseM', 0.016, 'ZEKF_noiseH', 0.0005, 'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1);

% stateCal1 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.00000002, 'ZEKF_noiseF',0.0006, 'ZEKF_noiseG', 0.01, 'ZEKF_noiseV', 0.0012, 'ZEKF_noiseM', 0.016, 'ZEKF_noiseH', 0.0005, 'ZEKF_fadeQ', 1.0005, 'ZEKF_fadeWb', 1.000005, 'ZEKF_fadeV', 1.000005, 'ZEKF_fadeP', 1.00005);
% 
% stateCal2 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.00000002, 'ZEKF_noiseF',0.00088, 'ZEKF_noiseG', 0.01, 'ZEKF_noiseV', 0.0012, 'ZEKF_noiseM', 0.016, 'ZEKF_noiseH', 0.0005, 'ZEKF_fadeQ', 1.0005, 'ZEKF_fadeWb', 1.000005, 'ZEKF_fadeV', 1.000005, 'ZEKF_fadeP', 1.00005);

% stateCal2 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.0000004, 'ZEKF_noiseF',0.002, 'ZEKF_noiseG', 0.02, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.005, 'ZEKF_noiseH', 0.0005,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Madgwick_Beta', 0.006);
%                            
% stateCal3 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.00000042, 'ZEKF_noiseF',0.002, 'ZEKF_noiseG', 0.02, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.05, 'ZEKF_noiseH', 0.0005,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Madgwick_Beta', 0.006);
%                            
% stateCal4 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.00000045, 'ZEKF_noiseF',0.002, 'ZEKF_noiseG', 0.02, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.1, 'ZEKF_noiseH', 0.0005,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Madgwick_Beta', 0.006);
%                            
% stateCal5 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.00000048, 'ZEKF_noiseF',0.002, 'ZEKF_noiseG', 0.02, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.2, 'ZEKF_noiseH', 0.0005,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Madgwick_Beta', 0.006);
%                            
% stateCal6 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.0000005, 'ZEKF_noiseF',0.002, 'ZEKF_noiseG', 0.02, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.5, 'ZEKF_noiseH', 0.0005,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Madgwick_Beta', 0.006);
                                                 
                           
% stateCal2 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.000001, 'ZEKF_noiseF',0.01, 'ZEKF_noiseG', 0.25, 'ZEKF_noiseV', 0.002, 'ZEKF_noiseM', 0.1, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.01, 'Mahony_Ki', 0.000025, 'Aligner_stamp', 50);
%                            
% stateCal3 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.01, 'ZEKF_noiseG', 0.25, 'ZEKF_noiseV', 0.002, 'ZEKF_noiseM', 0.2, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.02, 'Mahony_Ki', 0.0001,'Aligner_stamp', 50);
%                            
% stateCal4 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.0000025, 'ZEKF_noiseF',0.01, 'ZEKF_noiseG', 0.25, 'ZEKF_noiseV', 0.002, 'ZEKF_noiseM', 0.3, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.08, 'Mahony_Ki', 0.0016,'Aligner_stamp', 50);
%                            
% stateCal5 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.01, 'ZEKF_noiseG', 0.25, 'ZEKF_noiseV', 0.002, 'ZEKF_noiseM', 0.4, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.1, 'Mahony_Ki', 0.0025,'Aligner_stamp', 50);
%                            
% stateCal6 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.01, 'ZEKF_noiseG', 0.25, 'ZEKF_noiseV', 0.002, 'ZEKF_noiseM', 0.5, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.4, 'Mahony_Ki', 0.004,'Aligner_stamp', 50);


% stateCal1 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.0000005, 'ZEKF_noiseF',0.01, 'ZEKF_noiseG', 0.085, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.1, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.1, 'Mahony_Ki', 0.0025);
%                            
% stateCal2 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.0000005, 'ZEKF_noiseF',0.011, 'ZEKF_noiseG', 0.086, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.1, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.1, 'Mahony_Ki', 0.0025);
%                            
% stateCal3 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.0000005, 'ZEKF_noiseF',0.012, 'ZEKF_noiseG', 0.087, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.2, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.1, 'Mahony_Ki', 0.0025);
%                            
% stateCal4 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.0000005, 'ZEKF_noiseF',0.014, 'ZEKF_noiseG', 0.088, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.3, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.1, 'Mahony_Ki', 0.0025);
%                            
% stateCal5 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.0000005, 'ZEKF_noiseF',0.015, 'ZEKF_noiseG', 0.09, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.5, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.1, 'Mahony_Ki', 0.0025);
%                            
% stateCal6 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.02, 'ZEKF_noiseWb', 0.0000005, 'ZEKF_noiseF',0.016, 'ZEKF_noiseG', 0.09, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.5, 'ZEKF_noiseH', 0.5,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.1, 'Mahony_Ki', 0.0025);

                           
stateCal1 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.007, 'ZEKF_noiseG', 0.04, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.06, 'ZEKF_noiseH', 0.05,...
                               'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.01, 'Mahony_Ki', 0.000025);
                           
% stateCal2 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.0075, 'ZEKF_noiseG', 0.04, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.06, 'ZEKF_noiseH', 0.05,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.01, 'Mahony_Ki', 0.000025);
% 
% stateCal3 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.008, 'ZEKF_noiseG', 0.04, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.06, 'ZEKF_noiseH', 0.05,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.01, 'Mahony_Ki', 0.000025);
% 
% stateCal4 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.0085, 'ZEKF_noiseG', 0.04, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.06, 'ZEKF_noiseH', 0.05,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.01, 'Mahony_Ki', 0.000025);
% 
% stateCal5 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.009, 'ZEKF_noiseG', 0.04, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.06, 'ZEKF_noiseH', 0.05,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.01, 'Mahony_Ki', 0.000025);
% 
% stateCal6 = EKFStateCalculator(iHandler, pHandler, 'ZEKF_noiseW', 0.002, 'ZEKF_noiseWb', 0.000002, 'ZEKF_noiseF',0.0095, 'ZEKF_noiseG', 0.04, 'ZEKF_noiseV', 0.001, 'ZEKF_noiseM', 0.06, 'ZEKF_noiseH', 0.05,...
%                                'ZEKF_fadeQ', 1, 'ZEKF_fadeWb', 1, 'ZEKF_fadeV', 1, 'ZEKF_fadeP', 1, 'Aligner', Utils.AHRS_MADGWICK, 'Mahony_Kp', 0.01, 'Mahony_Ki', 0.000025);
%% 进行运算
profile clear % 清除之前的分析信息

profile on % 启用性能分析

%同时计算构建的StateCalculator
stateCal1.solveState("stateCal1");
% stateCal2.solveState("stateCal2");
% stateCal3.solveState("stateCal3"); 
% stateCal4.solveState("stateCal4");
% stateCal5.solveState("stateCal5");
% stateCal6.solveState("stateCal6");

%% 绘图
%绘图采用静态绘图类Plotter，可以同时绘制出不同StateCalculator实例的计算结果，若想同时绘制多个示例
%送入参数需要按该格式传入[stateCal1, stateCal2, stateCal3, ...]

close all;
Plotter.plot_Tracks_2D(stateCal1);
% Plotter.plot_Tracks_2D(stateCal2);
% Plotter.plot_Tracks_2D(stateCal3);
% Plotter.plot_Tracks_2D(stateCal4);
% Plotter.plot_Tracks_2D(stateCal5);
% Plotter.plot_Tracks_2D(stateCal6);
% Plotter.plot_Tracks_2D([stateCal1, stateCal2]);
% Plotter.plot_Tracks_2D([stateCal1, stateCal2, stateCal3, stateCal4, stateCal5, stateCal6]);
% Plotter.plot_Tracks_3D(stateCal6);
% Plotter.plot_Tracks_3D(stateCal5);
% Plotter.plot_Tracks_3D([stateCal1, stateCal2, stateCal3, stateCal4, stateCal5, stateCal6]);
% Plotter.plot_Aligner(stateCal1);
% Plotter.plotEuler(stateCal3);
% Plotter.plotEuler(stateCal5);
% Plotter.plotEuler(stateCal1);
% Plotter.plotEuler(stateCal3);
% Plotter.plotEuler(stateCal4);
% Plotter.plotEuler(stateCal5);
% Plotter.plotEuler([stateCal1, stateCal2, stateCal3, stateCal4, stateCal5]);
% Plotter.plotAllEuler(stateCal1);
% Plotter.plot_AllQuaternion(stateCal6);
% Plotter.plot_Acc(stateCal1);
% Plotter.plot_Velocity(stateCal1);
% Plotter.plot_ErrG(stateCal6);
% Plotter.plot_ErrM(stateCal6);
% Plotter.plot_ErrV(stateCal6);
% Plotter.plot_Rkg(stateCal6);
% Plotter.plot_Rkm(stateCal6);
% Plotter.plot_HorizontalVelNorm(stateCal1);
% Plotter.plot_TriaxialVelNorm(stateCal1);
% Plotter.plot_Quaternion(stateCal1); 
% Plotter.plot_Gyroscope(stateCal1);
% Plotter.plot_Accelerometer(stateCal1);
% Plotter.plot_Magnetic(stateCal1);
% Plotter.plot_Gait(stateCal2); 
% Plotter.plot_V_COPVel(stateCal1);

% Plotter.plot_AccRaw_Sum(stateCal1);
% Plotter.plot_GyroRaw_Sum(stateCal1);

